# 项目设计文档
项目名称：8086汇编模拟文件系统（多级目录与文件管理）
## 1. 项目概述

本项目旨在实现一个简单的文件管理系统，使用8086汇编语言编写，模拟文件的创建、删除、读取、写入、查找等操作，并支持多级目录结构。项目将使用内存中的数据结构来模拟磁盘存储，并采用链表或树状结构表示目录和文件的层级关系。

## 2. 项目目标

创建文件：允许用户在指定目录下创建文件，并确保文件名唯一，避免同名文件。

多级目录：支持创建多级目录结构，每个目录可以包含子目录和文件，形成树状结构。

文件操作：支持基本的文件操作，包括创建文件、读取文件、删除文件、查找文件。

目录操作：支持目录的创建、删除以及列出当前目录下的文件和子目录。

内存管理：通过划定特定的内存区域来模拟磁盘存储，并使用链表或指针管理文件系统。

## 3. 系统结构
### 3.1 文件结构

每个文件包含以下信息：

文件名（最大20字节）

文件大小（2字节）

文件内容（最大256字节）

指向下一个文件的指针（2字节）

文件结构定义：

file_entry:
    db 20 dup(0)      ; 文件名，最大20字节
    dw 0              ; 文件大小（2字节）
    db 256 dup(0)     ; 文件内容（最大256字节）
    dw 0              ; 指向下一个文件的指针（2字节）

### 3.2 目录结构

每个目录包含以下信息：

目录名（最大20字节）

子目录数量（2字节）

文件数量（2字节）

文件列表指针（2字节）

子目录列表指针（2字节）

下一个兄弟目录的指针（2字节）

目录结构定义：

directory_entry:
    db 20 dup(0)      ; 目录名，最大20字节
    dw 0              ; 子目录数量（2字节）
    dw 0              ; 文件数量（2字节）
    dw 0              ; 指向文件列表的指针（2字节）
    dw 0              ; 指向子目录列表的指针（2字节）
    dw 0              ; 指向下一个兄弟目录的指针（2字节）

### 3.3 文件系统区域

文件系统的所有文件和目录信息将存储在一个特定的内存区域中。该区域划定为一个固定的内存段，例如：

section .bss
    file_system_area resb 1024  ; 划定1024字节的内存区域来存储文件系统

## 4. 功能模块
### 4.1 创建文件

目标：在指定目录下创建文件，检查是否已存在同名文件。

流程：

遍历目标目录的文件列表，检查是否有同名文件。

如果同名文件存在，则返回错误提示。

如果没有同名文件，创建新文件结构并将文件添加到文件列表中。

关键代码片段：

create_file_in_directory:
    ; 遍历目标目录文件列表，检查是否存在同名文件
    ; 如果没有同名文件，创建文件并更新目录文件列表

### 4.2 创建目录

目标：在指定位置创建子目录，支持多级目录结构。

流程：

定位到父目录。

检查目标目录是否已经存在。

如果不存在，创建目录并将其添加到父目录的子目录列表中。

关键代码片段：

create_subdirectory:
    ; 定位到父目录并创建子目录
    ; 更新父目录的子目录列表

### 4.3 查找文件/目录

目标：在指定目录或全局范围内查找文件或子目录。

流程：

从根目录开始，递归遍历每个目录。

检查文件或子目录是否存在。

返回找到的文件或目录地址，或者未找到的提示。

关键代码片段：

find_file_or_dir:
    ; 遍历目录树查找文件或目录
    ; 返回找到的文件/目录地址
    ; 返回未找到的提示

### 4.4 删除文件/目录

目标：删除指定的文件或目录。

流程：

查找指定文件或目录。

从父目录的文件/子目录列表中删除目标。

释放目标文件或目录所占用的内存。

关键代码片段：

delete_file_or_dir:
    ; 查找并删除指定的文件或目录
    ; 更新父目录的文件/子目录列表

## 5. 数据结构设计 

文件管理：文件通过链表或数组存储在目录结构中，每个文件结构包含文件名、大小、内容和指向下一个文件的指针。

目录管理：每个目录通过链表存储在父目录中，目录结构包含目录名、文件指针、子目录指针和指向下一个兄弟目录的指针。

## 6. 内存管理

文件系统区域：所有文件和目录的元数据存储在一个划定的内存区域中，确保文件系统的管理空间是集中且高效的。

内存分配：文件和目录结构的内存分配是动态的，每次创建文件或目录时，程序会分配必要的内存空间，并确保不会发生内存冲突。

内存释放：删除文件或目录时，程序会释放相关内存空间，确保内存管理的有效性。

## 7. 错误处理

同名文件错误：在创建文件时，程序会检查是否已存在同名文件。如果存在同名文件，则返回错误提示。

目录已存在错误：在创建目录时，程序会检查目标目录是否已存在。如果存在相同目录，则返回错误提示。

## 8. 用户命令

用户通过命令行输入指令与文件系统交互，常用的命令包括：

CREATE FILE <filename>：在当前目录下创建文件。

CREATE DIRECTORY <dirname>：在当前目录下创建子目录。

LIST：列出当前目录下的文件和子目录。

DELETE FILE <filename>：删除指定文件。

DELETE DIRECTORY <dirname>：删除指定目录。

FIND <filename>：查找文件或目录。

## 9. 项目扩展和优化

哈希表优化：为了提高文件查找效率，可以为文件名生成哈希值，并使用哈希表来优化文件名的查重和查找过程。

排序和二分查找：对于较大的目录，可以考虑对文件列表进行排序，并使用二分查找算法来提高查找效率。

## 10.  未来工作

增加文件读写操作：目前的设计只是支持文件的创建和删除，未来可以扩展为支持文件内容的读写。

持久化存储：目前所有的数据都保存在内存中，未来可以扩展为模拟磁盘文件存储，并将数据持久化到文件中。

用户界面：可以为该系统设计一个简单的文本界面，允许用户通过图形界面与文件系统交互。

11. 总结

通过模拟一个简单的文件系统，项目展示了如何在8086汇编语言中实现文件的管理、目录的层级结构、内存的动态分配与管理，并处理文件创建时的同名文件检查。未来可以进一步优化性能，增加更多功能，向更复杂的文件系统系统扩展。